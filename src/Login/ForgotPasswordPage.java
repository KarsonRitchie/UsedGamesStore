/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package Login;

import Global.Methods;
import SQL.SQLLogin;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.swing.*;

/**
 *
 * @author karso
 */
public class ForgotPasswordPage extends javax.swing.JFrame {

    LogonPage tempLogin;
    //This is to hold the variable temporarily and make it visible easier

    //Array list to hold errors
    ArrayList<String> passwordErrors = new ArrayList<String>();

    /**
     * Creates new form ForgotPasswordPage
     */
    public ForgotPasswordPage(LogonPage login) {
        initComponents();

        tempLogin = login;
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        backgroundPanel = new javax.swing.JPanel();
        container = new javax.swing.JLayeredPane();
        titleLabel = new javax.swing.JLabel();
        sequrityQuestionPanel = new javax.swing.JPanel();
        a1 = new javax.swing.JTextField();
        a2 = new javax.swing.JTextField();
        a3 = new javax.swing.JTextField();
        q1 = new javax.swing.JTextField();
        q2 = new javax.swing.JTextField();
        q3 = new javax.swing.JTextField();
        changeButton = new javax.swing.JButton();
        usernameLabel = new javax.swing.JLabel();
        usernameField = new javax.swing.JTextField();
        usernameCheckButton = new javax.swing.JButton();
        statusTextUsername = new javax.swing.JLabel();
        statusTextQuestions = new javax.swing.JLabel();
        showLabel = new javax.swing.JLabel();
        passwordField = new javax.swing.JPasswordField();
        returnButton = new javax.swing.JButton();
        instructions = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        passwordErrorMessage = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Change Password");
        setIconImage(new javax.swing.ImageIcon(getClass().getResource("/UsedGamesLogo.png")).getImage());
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });

        backgroundPanel.setBackground(new java.awt.Color(0, 116, 217));

        titleLabel.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        titleLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        titleLabel.setText("Forgot Password");

        sequrityQuestionPanel.setBackground(new java.awt.Color(122, 186, 242));

        a1.setEnabled(false);

        a2.setEnabled(false);

        a3.setEnabled(false);

        q1.setEditable(false);

        q2.setEditable(false);

        q3.setEditable(false);

        javax.swing.GroupLayout sequrityQuestionPanelLayout = new javax.swing.GroupLayout(sequrityQuestionPanel);
        sequrityQuestionPanel.setLayout(sequrityQuestionPanelLayout);
        sequrityQuestionPanelLayout.setHorizontalGroup(
            sequrityQuestionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(sequrityQuestionPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(sequrityQuestionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(a1)
                    .addComponent(a2, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(a3, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(q1)
                    .addComponent(q2)
                    .addComponent(q3))
                .addContainerGap())
        );
        sequrityQuestionPanelLayout.setVerticalGroup(
            sequrityQuestionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(sequrityQuestionPanelLayout.createSequentialGroup()
                .addGap(22, 22, 22)
                .addComponent(q1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(a1, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(29, 29, 29)
                .addComponent(q2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(a2, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(36, 36, 36)
                .addComponent(q3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(a3, javax.swing.GroupLayout.PREFERRED_SIZE, 46, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        changeButton.setBackground(new java.awt.Color(0, 48, 90));
        changeButton.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        changeButton.setForeground(new java.awt.Color(255, 255, 255));
        changeButton.setText("Change Password");
        changeButton.setEnabled(false);
        changeButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                changeButtonActionPerformed(evt);
            }
        });

        usernameLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        usernameLabel.setText("Username");

        usernameCheckButton.setBackground(new java.awt.Color(0, 48, 90));
        usernameCheckButton.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        usernameCheckButton.setForeground(new java.awt.Color(255, 255, 255));
        usernameCheckButton.setText("Check Username");
        usernameCheckButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                usernameCheckButtonActionPerformed(evt);
            }
        });

        statusTextUsername.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        statusTextUsername.setForeground(new java.awt.Color(255, 51, 51));
        statusTextUsername.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        statusTextUsername.setText("The username was not found");

        statusTextQuestions.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        statusTextQuestions.setForeground(new java.awt.Color(255, 0, 51));
        statusTextQuestions.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        statusTextQuestions.setText("Answers do not match");

        showLabel.setText("Show");
        showLabel.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                showLabelMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                showLabelMouseExited(evt);
            }
        });

        passwordField.setEchoChar('*');
        passwordField.setEnabled(false);
        passwordField.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                passwordFieldMouseEntered(evt);
            }
        });
        passwordField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                passwordFieldKeyReleased(evt);
            }
        });

        returnButton.setBackground(new java.awt.Color(0, 48, 90));
        returnButton.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        returnButton.setForeground(new java.awt.Color(255, 255, 255));
        returnButton.setText("Return");
        returnButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                returnButtonActionPerformed(evt);
            }
        });

        instructions.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        instructions.setText("Input your username");

        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("New Password");

        passwordErrorMessage.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        passwordErrorMessage.setForeground(java.awt.Color.red);
        passwordErrorMessage.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        passwordErrorMessage.setText("jLabel2");

        container.setLayer(titleLabel, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(sequrityQuestionPanel, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(changeButton, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(usernameLabel, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(usernameField, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(usernameCheckButton, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(statusTextUsername, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(statusTextQuestions, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(showLabel, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(passwordField, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(returnButton, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(instructions, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(jLabel1, javax.swing.JLayeredPane.DEFAULT_LAYER);
        container.setLayer(passwordErrorMessage, javax.swing.JLayeredPane.DEFAULT_LAYER);

        javax.swing.GroupLayout containerLayout = new javax.swing.GroupLayout(container);
        container.setLayout(containerLayout);
        containerLayout.setHorizontalGroup(
            containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(containerLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(usernameLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 274, Short.MAX_VALUE)
                    .addComponent(passwordField)
                    .addComponent(changeButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(containerLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(showLabel)
                        .addGap(13, 13, 13))
                    .addComponent(passwordErrorMessage, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
            .addGroup(containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(containerLayout.createSequentialGroup()
                    .addContainerGap()
                    .addGroup(containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(statusTextQuestions, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(statusTextUsername, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(usernameCheckButton, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(usernameField)
                        .addComponent(sequrityQuestionPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(returnButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(containerLayout.createSequentialGroup()
                            .addGroup(containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(instructions, javax.swing.GroupLayout.PREFERRED_SIZE, 268, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(titleLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 274, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGap(0, 0, Short.MAX_VALUE)))
                    .addContainerGap()))
        );
        containerLayout.setVerticalGroup(
            containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(containerLayout.createSequentialGroup()
                .addGap(80, 80, 80)
                .addComponent(usernameLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 441, Short.MAX_VALUE)
                .addComponent(passwordErrorMessage)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(showLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(passwordField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(changeButton)
                .addGap(44, 44, 44))
            .addGroup(containerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(containerLayout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(titleLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGap(8, 8, 8)
                    .addComponent(instructions, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGap(28, 28, 28)
                    .addComponent(usernameField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addComponent(usernameCheckButton)
                    .addGap(11, 11, 11)
                    .addComponent(statusTextUsername)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                    .addComponent(sequrityQuestionPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGap(5, 5, 5)
                    .addComponent(statusTextQuestions)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 113, Short.MAX_VALUE)
                    .addComponent(returnButton)
                    .addContainerGap()))
        );

        javax.swing.GroupLayout backgroundPanelLayout = new javax.swing.GroupLayout(backgroundPanel);
        backgroundPanel.setLayout(backgroundPanelLayout);
        backgroundPanelLayout.setHorizontalGroup(
            backgroundPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(backgroundPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(container, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        backgroundPanelLayout.setVerticalGroup(
            backgroundPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(backgroundPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(container, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(backgroundPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(0, 6, Short.MAX_VALUE)
                .addComponent(backgroundPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed
        // TODO add your handling code here:
    }//GEN-LAST:event_formWindowClosed

    private void passwordFieldMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_passwordFieldMouseEntered
        // TODO add your handling code here:
    }//GEN-LAST:event_passwordFieldMouseEntered

    private void showLabelMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_showLabelMouseEntered
        passwordField.setEchoChar((char) 0);
    }//GEN-LAST:event_showLabelMouseEntered

    private void showLabelMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_showLabelMouseExited
        passwordField.setEchoChar('*');
    }//GEN-LAST:event_showLabelMouseExited

    private void passwordFieldKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_passwordFieldKeyReleased
        passwordErrors = Methods.checkPassword(Methods.getPassword(passwordField.getPassword()));

        Methods.checkForErrors(passwordErrors, passwordErrorMessage);
    }//GEN-LAST:event_passwordFieldKeyReleased

    private void usernameCheckButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_usernameCheckButtonActionPerformed
        checkUsername();
    }//GEN-LAST:event_usernameCheckButtonActionPerformed

    private void changeButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_changeButtonActionPerformed
        //The password is attempting to be changed

        //Just run a function we made
        checkAnswers();
    }//GEN-LAST:event_changeButtonActionPerformed

    private void returnButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_returnButtonActionPerformed
        this.dispose();
        tempLogin.run();
    }//GEN-LAST:event_returnButtonActionPerformed

    /**
     * //@param args the command line arguments
     */
//    public static void main(String args[]) {
//        /* Set the Nimbus look and feel */
//        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
//        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
//         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
//         */
//        try {
//            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
//                if ("Nimbus".equals(info.getName())) {
//                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
//                    break;
//                }
//            }
//        } catch (ClassNotFoundException ex) {
//            java.util.logging.Logger.getLogger(ForgotPasswordPage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
//        } catch (InstantiationException ex) {
//            java.util.logging.Logger.getLogger(ForgotPasswordPage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
//        } catch (IllegalAccessException ex) {
//            java.util.logging.Logger.getLogger(ForgotPasswordPage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
//        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
//            java.util.logging.Logger.getLogger(ForgotPasswordPage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
//        }
//        //</editor-fold>
//
//        /* Create and display the form */
//        java.awt.EventQueue.invokeLater(new Runnable() {
//            public void run() {
//
//            }
//        });
//    }

    public void checkUsername() {

        //First we will run a query that checks for the existence of the username
        //We can easily reuse a function from SQLLogin
        String status = SQLLogin.checkUsername(usernameField.getText());

        //When the status is returned we will then fill the appropiate text boxes with the questions
        //If not return an error
        if (status.equals("Found")) {

            q1.setText(SQLLogin.getQuestion(1, usernameField.getText()));
            q2.setText(SQLLogin.getQuestion(2, usernameField.getText()));
            q3.setText(SQLLogin.getQuestion(3, usernameField.getText()));

            //also enable the text fields for editing and disable the ones for the username
            usernameField.setEditable(false);
            usernameCheckButton.setEnabled(false);

            a1.setEnabled(true);
            a2.setEnabled(true);
            a3.setEnabled(true);

            passwordField.setEnabled(true);
            changeButton.setEnabled(true);

            statusTextUsername.setVisible(false);

            //Change the instructions
            instructions.setText("Answer the questions and enter a password");

        } else if (status.equals("Not")) {

            //Username was not found, let the user know
            statusTextUsername.setText("Username Not Found");
            statusTextUsername.setVisible(true);

        }else{
        
            statusTextUsername.setText("An Error occured, please try again");
            statusTextUsername.setVisible(true);
        
        }
    }

    //We need to let the user know if they got their questions right or wrong
    //if they are right the password will be changed successfully
    public void checkAnswers() {

        //First we get the password
        String password = Methods.getPassword(passwordField.getPassword());

        //And before we can continue we must make sure the password is validated
        boolean passwordValid = validatePassword(password);

        //Now we will use a method in SQLLogin that will alter the password
        if (passwordValid == true) {
            String passwordStatus = SQLLogin.changePassword(password, usernameField.getText(), a1.getText(), a2.getText(), a3.getText());

            //Use the new boolean to act accordingly
            if (passwordStatus.equals("Changed")) {

                statusTextQuestions.setVisible(false);
                
                tempLogin.run();
                tempLogin.setStatus("Password successfully changed");
                this.dispose();
                

            } else if(passwordStatus.equals("Not")) {

                statusTextQuestions.setText("Answers do not match");
                statusTextQuestions.setVisible(true);

            }else{
            
                statusTextQuestions.setText("An error occured");
                statusTextQuestions.setVisible(true);
            
            }
        }

    }

    private boolean validatePassword(String tempPassword) {

        boolean valid;

        passwordErrors = Methods.checkPassword(Methods.getPassword(passwordField.getPassword()));

        Methods.checkForErrors(passwordErrors, passwordErrorMessage);
        
        if (passwordErrors.size() > 0) {

            valid = false;

        } else {

            valid = true;

        }

        return valid;
    }

    public void open() {

        //This is to start the page in its default state and make it visible
        usernameField.setEditable(true);
        usernameCheckButton.setEnabled(true);

        a1.setEnabled(false);
        a2.setEnabled(false);
        a3.setEnabled(false);

        passwordField.setEnabled(false);
        changeButton.setEnabled(false);

        //Now we will erase the text
        usernameField.setText("");
        passwordField.setText("");
        q1.setText("");
        q2.setText("");
        q3.setText("");
        a1.setText("");
        a2.setText("");
        a3.setText("");

        //Make error stuff invisible
        statusTextUsername.setVisible(false);
        statusTextQuestions.setVisible(false);
        passwordErrorMessage.setVisible(false);
        
        //Reset the instructions
        instructions.setText("Input your username and check");

        //Now make it visible
        this.setVisible(true);

    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField a1;
    private javax.swing.JTextField a2;
    private javax.swing.JTextField a3;
    private javax.swing.JPanel backgroundPanel;
    private javax.swing.JButton changeButton;
    private javax.swing.JLayeredPane container;
    private javax.swing.JLabel instructions;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel passwordErrorMessage;
    private javax.swing.JPasswordField passwordField;
    private javax.swing.JTextField q1;
    private javax.swing.JTextField q2;
    private javax.swing.JTextField q3;
    private javax.swing.JButton returnButton;
    private javax.swing.JPanel sequrityQuestionPanel;
    private javax.swing.JLabel showLabel;
    private javax.swing.JLabel statusTextQuestions;
    private javax.swing.JLabel statusTextUsername;
    private javax.swing.JLabel titleLabel;
    private javax.swing.JButton usernameCheckButton;
    private javax.swing.JTextField usernameField;
    private javax.swing.JLabel usernameLabel;
    // End of variables declaration//GEN-END:variables
}
